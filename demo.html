<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUXEval Sample Explorer</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link rel="shortcut icon" href="#" />

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      .container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .header,
      .buttons,
      .footer,
      .key {
        flex-shrink: 0;
      }

      .header {
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .footer {
        padding: 10px;
        font-size: 12px;
      }

      .scrollable-div {
        /* flex-grow: 1; */
        height: calc(100vh - 460px);
        overflow-y: auto;
        background-color: #f5f5f5;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid black;
      }

      .buttons {
        margin-top: 10px;
      }

      .btn {
        margin-bottom: 7px;
      }

      .left-col {
        width: 200px; /* Adjust this value as per your requirement */
      }

      .left-half {
        width: 50%; /* Adjust this value as per your requirement */
      }

      table tr,
      table td {
        border: none !important;
      }

      .bottom-border {
        border-bottom: 1px solid gray !important;
      }

      .generation {
        background-color: #3ebd66; /* Color for "Correct" */
      }

      .generation.correct {
        background-color: #3ebd66; /* Color for "Correct" */
      }

      .generation.incorrect{
        background-color: rgb(255 187 187); /* Color for "Incorrect" */
      }
    </style>

  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header row center-content">
        <div class="col text-center">
          <p style="margin-top: -10px">CruxEval EXPLORER</p>
          <a href="#">arXiv</a> | 
          <a href="#">GitHub</a>
        </div>
      </div>

      <!-- Scrollable Content Area -->
      <div class="scrollable-div">
        <table class="table">
          <tr>
              <td>
                <code class="python"><pre id="problem"></pre></code>
              </td>
          </tr>
          <tr>
            <td>
              <label for="models">model:</label> 
              <select name="model-names" id="models"> 
                  <option value="codellama-34b">codellama-34b</option> 
                  <option value="gpt-4-0613">gpt-4-0613</option>
                  <option value="gpt-3.5-turbo-0613">gpt-3.5-turbo-0613</option>
              </select>
              &nbsp;
              &nbsp;
              <label for="temps">temp:</label> 
              <select name="temps" id="temps"> 
                  <option value="0.8">0.8</option> 
                  <option value="0.2">0.2</option> 
              </select>
            </td>
          </tr>

          <tr>
            <td class="left-half">
              <b>CRUXEval-I</b>
              <code class="python"><pre id="input_task"></pre></code>
              <code class="python"><pre id="inputs"></pre></code>
            </td>
          </tr>
          <tr>
            <td>
              <b>CRUXEval-O</b>
              <code class="python"><pre id="output_task"></pre></code>
              <code class="python"><pre id="outputs"></pre></code>
            </td>
          </tr>
        </table>
      </div>

      <!-- Key -->
      <!-- <div class="key mt-3 text-center">
        <span class="key-item correct">Correct</span>
        <span class="key-item incorrect">Incorrect</span>
      </div> -->

      <div class="navigation-buttons text-center mt-3">
        <button type="button" id="leftButton" class="btn btn-secondary">
          &lt;&lt;
        </button>
        <button type="button" id="randButton" class="btn btn-secondary">
          ??
        </button>
        <button type="button" id="rightButton" class="btn btn-secondary">
          &gt;&gt;
        </button>
        <div class="mt-2">
          <span id="currentPage">1</span> / <span id="totalPages">4</span>
        </div>
      </div>

      <!-- Footer -->
      <div class="footer text-center mt-3">
        The site is inspired by and based on
        <a href="https://minerva-demo.github.io">Minerva sample explorer</a>.
        <a href="https://llemma-demo.github.io/">Llemma</a>.
      </div>


    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="cruxeval.js"></script>

    <script>
      $(document).ready(function () {
        let searchParams = new URLSearchParams(window.location.search);
        let currentPage = 1
        if (searchParams.has("id")) {
          currentPage = searchParams.get('id')
        }
      
        let currentModel = "codellama-34b"
        let currentTemp = 0.8
        let totalPages = 800;
        let typingInterval; // outside of the function, to store the interval ID
        let isTyping = false;
        
        data = DATA
        totalPages = data.length;
        $("#totalPages").text(totalPages);
        $("#currentPage").text(currentPage);
        updateData(currentPage);
        updateButtonStatus();
    
        function updateData(idx) {
          idx = idx - 1;
          code = data[idx]["code"] + "\nassert f(" + data[idx]["input"] + ") == " + data[idx]["output"]; 
          $("#problem").text(code);

          $("#input_task").text("assert f(??) == " + data[idx]["output"]);
          $("#output_task").text("assert f(" + data[idx]["input"] + ") == ??");

          function getn(json) {
            items = []
            for (var i = 0; i < 10; i++) {
              si = json['raw_generations']['sample_' + idx][i]
              ci = json['raw_scored_generations']['sample_' + idx][i]? "correct" : "incorrect"
              items.push(`<span class="generation ${ci}"> ${si} </span><br>`)
            }
            return items
          }
          fetch(`./evaluation_results/${currentModel}_temp${currentTemp}_input.json`)
            .then((response) => response.json())
            .then((json) => {
              items = getn(json)
              $("#inputs").html(items)
            });
          fetch(`./evaluation_results/${currentModel}_temp${currentTemp}_output.json`)
            .then((response) => response.json())
            .then((json) => {
              items = getn(json)
              $("#outputs").html(items)
            });
        }

        function updateModels() {
          models = [
           "codellama-34b", "codellama-34b+cot", "codellama-13b", "codellama-13b+cot",
           "deepseek-instruct-33b", "deepseek-base-33b", "codetulu-2-34b",
           "gpt-4-0613", "gpt-4-0613+cot", "gpt-3.5-turbo-0613", "gpt-3.5-turbo-0613+cot",
           "mistral-7b", "phi-2", "phi-1.5"]
          items = models.map(m => `<option value="${m}">${m}</option>`)
          $('#models').html(items)
        }
        updateModels();

        function updateButtonStatus() {
          // Disable the left button if at the beginning
          if (currentPage <= 1) {
            $("#leftButton").prop("disabled", true);
          } else {
            $("#leftButton").prop("disabled", false);
          }

          // Disable the right button if at the end
          if (currentPage >= totalPages) {
            $("#rightButton").prop("disabled", true);
          } else {
            $("#rightButton").prop("disabled", false);
          }
        }

        // Initial button status update
        updateButtonStatus();

        $("#leftButton").click(function () {
          if (currentPage > 1) {
            currentPage--;
            $("#currentPage").text(currentPage);
            updateData(currentPage);
          }
          updateButtonStatus();
        });

        $("#randButton").click(function () {
          currentPage = Math.floor(Math.random() * totalPages) + 1;
          $("#currentPage").text(currentPage);
          updateData(currentPage);
        });

        $("#rightButton").click(function () {
          if (currentPage < totalPages) {
            currentPage++;
            $("#currentPage").text(currentPage);
            updateData(currentPage);
          }
          updateButtonStatus();
        });

        $(document).keydown(function (e) {
          switch (e.which) {
            case 37: // left arrow key
              if (currentPage > 1) {
                currentPage--;
                $("#currentPage").text(currentPage);
                updateData(currentPage);
              }
              updateButtonStatus();
              break;

            case 39: // right arrow key
              if (currentPage < totalPages) {
                currentPage++;
                $("#currentPage").text(currentPage);
                updateData(currentPage);
              }
              updateButtonStatus();
              break;

            default:
              return; // exit this handler for other keys
          }
          e.preventDefault(); // prevent the default action (scroll / move caret)
        });

        $("#models").change(function(){
          currentModel = $('#models').val()
          updateData(currentPage);
        });

        $("#temps").change(function(){
          currentTemp = $('#temps').val()
          updateData(currentPage);
        });
      });
    </script>
  </body>
</html>
